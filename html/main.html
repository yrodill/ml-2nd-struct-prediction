<!DOCTYPE html>
<html>

<head>


    <meta charset="utf8">
    <title>StruBiGL</title>

    <script type="text/javascript" , src="../data/mainlybeta.js"></script>
    <script type="text/javascript" , src="../data/mainlyalphaG.js"></script>
    <script type="text/javascript" , src="../data/alphaH.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.13.3/dist/tf.min.js"> </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/brain/0.6.3/brain.js"></script>
    <script type="module">

        'use strict';

        /*Find features and store them*/

        function process(data) {
            let result = [];
            let tab = data.split("\n");

            for (let i = 0; i < tab.length; i++) {
                let sequence = "";
                if (tab[i] != "" && tab[i][0] != ">") {
                    while (tab[i] != "" && tab[i][0] != ">") {
                        sequence += tab[i];
                        i++;
                    }
                    result.push(sequence);
                }
            }

            console.log(result);

            let betaFeatures = []; for (let i = 0; i < result.length; i++) {
                let matrix = { "A": 0, "D": 0, "R": 0, "N": 0, "C": 0, "E": 0, "Q": 0, "G": 0, "H": 0, "I": 0, "L": 0, "K": 0, "M": 0, "F": 0, "P": 0, "S": 0, "T": 0, "W": 0, "Y": 0, "V": 0 }; for (let j = 0; j < result[i].length; j++) { matrix[result[i][j]] += 1; } let len = result[i].length;
                for (let key in matrix) {
                    matrix[key] = matrix[key] / len;
                }
                betaFeatures[i] = matrix;
            }
            console.log(betaFeatures);
            return betaFeatures;

        }
        /*MAIN*/
        var betaFeatures = process(dataset);
        var alphaTest = process(alpha);
        var alphaHTest = process(alphaH)

        /*Training and inferences*/
        /* Features format : [{input:{features} , output:{beta:1,alpha:0}}]*/
        var net = new brain.NeuralNetwork();
        var config = [{input:{},output:{}}];

        for (var features in betaFeatures) {
            config.push({input:{features},output:{beta:1,alpha:0}});
        }
        for (var features in alphaTest) {
            config.push({input:{features},output:{beta:0,alpha:1}});
        }
        net.train(config);

        console.log(net);


        // for (var features in alphaHTest) {
        //     net.train([{ input: features, output: { beta: 0, alpha: 1 } }]);
        // }

        // console.log(net);

        for (var features in alphaHTest) {
            var output = net.run(features)  // { white: 0.99, black: 0.002 }
            console.log(output);
        }
    </script>
</head>

<body>
</body>

</html>